(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{107:function(t,e,n){},108:function(t,e,n){"use strict";n.r(e);var s=n(1),c=n(0),a=n.n(c),i=n(60),o=n.n(i),r=n(23),l=n(3),u=(n(70),n(25)),d=n(21),h=n(32),j=n(31);function m(t){var e,n;return(null!==(e=null===(n=t[0])||void 0===n?void 0:n.toUpperCase())&&void 0!==e?e:"")+t.slice(1)}Window.prototype.fetchBackend=function(t,e){var n=window.location,s="localhost"===n.hostname?"".concat(n.hostname,":8000"):n.hostname;return fetch("".concat(n.protocol,"//").concat(s,"/api").concat(t),e).then((function(t){return t.json()}))};n(71);var b=function(t){Object(h.a)(n,t);var e=Object(j.a)(n);function n(t){var c;return Object(u.a)(this,n),(c=e.call(this,t)).render=function(){return Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)(r.b,{to:"/create-room",children:Object(s.jsx)("button",{children:"Create Room"})}),Object(s.jsx)("ul",{id:"rooms",children:c.state.rooms.map((function(t){return Object(s.jsx)("li",{className:"room",children:Object(s.jsx)("a",{href:"/room/".concat(t),children:t})},t)}))})]})},c.state={rooms:[]},c}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=this;window.fetchBackend("/rooms").then((function(e){console.log(e),t.setState({rooms:e})}))}}]),n}(c.Component),f=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,109)).then((function(e){var n=e.getCLS,s=e.getFID,c=e.getFCP,a=e.getLCP,i=e.getTTFB;n(t),s(t),c(t),a(t),i(t)}))},x=n(8),v=n(4),p=n.n(v),g=n(11),O=n(10),y=n(62);var k=function(){var t=Object(y.a)({defaultValues:{time:180}}),e=t.register,n=t.handleSubmit,a=t.setValue,i=Object(c.useState)([]),o=Object(O.a)(i,2),r=o[0],u=o[1],d=Object(l.f)(),h=function(){var t=Object(g.a)(p.a.mark((function t(e){var n,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetchBackend("/create-room",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});case 2:n=t.sent,s=n.success,d.push(s?"/room/".concat(e.name):"/");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(c.useEffect)((function(){window.fetchBackend("/categories").then((function(t){u(t);var e,n=Object(x.a)(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;a(s,!0)}}catch(c){n.e(c)}finally{n.f()}}))}),[a]),Object(s.jsx)("div",{id:"App",children:Object(s.jsxs)("form",{onSubmit:n(h),children:[Object(s.jsx)("input",{ref:e,type:"text",name:"name"},"name"),Object(s.jsx)("br",{}),r.map((function(t){return Object(s.jsxs)("label",{htmlFor:t,children:[m(t),":",Object(s.jsx)("input",{ref:e,type:"checkbox",name:t}),Object(s.jsx)("br",{})]},t)})),Object(s.jsx)("input",{ref:e,type:"number",name:"time",min:"60",max:"300"},"time"),Object(s.jsx)("input",{type:"submit"})]})})},w=n(2),S=n(63),C=n(64),N=(n(107),function(t){Object(h.a)(n,t);var e=Object(j.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).canvas=void 0,a.room=void 0,a.colours=void 0,a.brush=void 0,a.socket=Object(C.io)({secure:!0,"sync disconnect on unload":!0}),a.nick=null,a.handleMouseDown=function(){if(a.isDrawer){var t=a.state.mouse;"paint"===a.brush.tool?(a.ctx.beginPath(),a.ctx.moveTo(t.x+.5,t.y+.5),a.ctx.lineTo(t.x+.5,t.y+.5),a.ctx.stroke(),a.setState({drawing:!0}),a.socket.emit("mouse_down",t)):(a.floodFill(t.x,t.y),a.socket.emit("fill",t))}},a.handleMouseMove=function(t){var e={x:0,y:0},n=a.canvas.current.getBoundingClientRect();e.x=t.clientX-n.left,e.y=t.clientY-n.top,a.setState({mouse:e}),a.state.drawing&&(a.ctx.lineTo(e.x+.5,e.y+.5),a.ctx.stroke(),a.socket.emit("mouse_move",e))},a.clearCanvas=function(){a.ctx.fillStyle="#fff",a.ctx.fillRect(0,0,a.canvas.current.width,a.canvas.current.height),a.ctx.fillStyle=a.brush.colour,a.socket.emit("clear_canvas")},a.changeTool=function(t){a.brush.tool=t,a.forceUpdate(),a.brush.updateCursor()},a.messageInput=function(t){"Enter"===t.key&&(t.preventDefault(),a.socket.emit("chat_message",a.state.message),a.setState({message:""}))},a.render=function(){var t,e,n,c;console.log(a.brush.colour);var i=a.colours.map((function(t){return Object(s.jsx)("td",{className:"colour"+(a.brush.colour===t?" active":""),style:{background:t},onClick:function(){return a.changeColour(t)}},t)}));return Object(s.jsxs)("div",{className:"App Room",children:[Object(s.jsxs)("div",{id:"chat",children:[Object(s.jsx)("ul",{id:"players",children:a.state.players.sort((function(t,e){return e.points-t.points})).map((function(t){return Object(s.jsxs)("li",{id:t.id,className:"player",children:[Object(s.jsx)("span",{className:"player-icon material-icons",children:"person"}),Object(s.jsx)("div",{className:"player-name",children:t.name}),Object(s.jsx)("div",{className:"player-points",children:t.points})]},t.id)}))}),Object(s.jsx)("div",{id:"messages",children:a.state.chat}),Object(s.jsxs)("div",{id:"message-input",children:[Object(s.jsx)("div",{className:"button",children:Object(s.jsx)("button",{children:Object(s.jsx)("span",{className:"material-icons",children:"send"})})}),Object(s.jsx)("div",{className:"input",children:Object(s.jsx)("input",{type:"text",placeholder:"Make a guess",value:a.state.message,onChange:function(t){return a.setState({message:t.target.value})},onKeyPress:a.messageInput})})]})]}),Object(s.jsxs)("div",{id:"topbar",children:[Object(s.jsx)("div",{id:"timer",children:a.formatTime(a.state.time)}),Object(s.jsxs)("div",{id:"hint",children:[Object(s.jsx)("div",{className:"category",children:m(null!==(t=null===(e=a.state.hint)||void 0===e?void 0:e.category)&&void 0!==t?t:"")}),Object(s.jsx)("pre",{className:"word",children:null!==(n=null===(c=a.state.hint)||void 0===c?void 0:c.word)&&void 0!==n?n:""})]}),a.state.word&&Object(s.jsx)(M,Object(S.a)({},a.state.word))]}),Object(s.jsxs)("div",{id:"brush",children:[Object(s.jsx)("table",{id:"colours",children:Object(s.jsxs)("tbody",{children:[Object(s.jsx)("tr",{children:i.slice(0,a.colours.length/2)}),Object(s.jsx)("tr",{children:i.slice(a.colours.length/2)})]})}),Object(s.jsx)("div",{id:"size",children:Object(s.jsxs)("div",{className:"inner",children:[Object(s.jsx)("label",{htmlFor:"size-input",children:"Size"}),Object(s.jsx)("input",{id:"size-input",name:"size-input",type:"range",min:"5",max:"50",value:a.state.brushSize,onChange:function(t){var e=+t.target.value;a.ctx.lineWidth=e,a.setState({brushSize:e}),a.socket.emit("brush_size",e)}})]})}),Object(s.jsx)("button",{className:"tool-button icon-button"+("paint"===a.brush.tool?" active":""),onClick:function(){return a.changeTool("paint")},disabled:"paint"===a.brush.tool,children:Object(s.jsx)("span",{className:"material-icons",children:"brush"})}),Object(s.jsx)("button",{className:"tool-button icon-button"+("fill"===a.brush.tool?" active":""),onClick:function(){return a.changeTool("fill")},disabled:"fill"===a.brush.tool,children:Object(s.jsx)("span",{className:"material-icons",children:"format_paint"})}),Object(s.jsx)("button",{className:"icon-button",onClick:function(){a.isDrawer&&a.clearCanvas()},children:Object(s.jsx)("span",{className:"material-icons",children:"delete"})})]}),Object(s.jsxs)("div",{id:"game",children:[Object(s.jsx)("canvas",{id:"canvasGame",ref:a.canvas,onContextMenu:function(t){return t.preventDefault()},onMouseDown:a.handleMouseDown,onMouseMove:a.handleMouseMove,children:"HTML Canvas isn't supported on your browser."}),a.state.choices&&Object(s.jsx)("div",{id:"choices",children:a.state.choices.map((function(t){return Object(s.jsx)("button",{className:"choice",onClick:function(){a.socket.emit("choice",{id:t.id,category:t.category})},children:t.word},t.id)}))})]})]})},a.state={drawing:!1,mouse:{x:0,y:0},brushSize:10,chat:[],message:"",time:0,players:[]},a.canvas=Object(c.createRef)(),a.brush=new F(a.canvas),a.room=t.match.params.room,a.colours=["A90F00","FF1800","ED7000","FFA400","FFF000","A0EB39","006B00","AAD4E9","2074DD","000EFF","E721DF","75106F","FFE1AC","63400C","412D07","979697","686769","464446","010001","ffffff"].map((function(t){return"#"+t})),a}return Object(d.a)(n,[{key:"ctx",get:function(){return this.canvas.current.getContext("2d")}},{key:"isDrawer",get:function(){return this.state.drawer===this.socket.id}}]),Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.socket;for(this.nick=null;null===(this.nick=prompt("Nickname")););e.emit("join",this.room,this.nick),this.addMessage(Object(s.jsxs)("div",{className:"message reveal",children:[this.nick," has joined the room."]}));var n=this.canvas.current.getBoundingClientRect();this.ctx.canvas.width=n.width,this.ctx.canvas.height=n.height,this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="#ffffff",this.clearCanvas(),this.ctx.lineWidth=10,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.changeColour("#010001"),document.addEventListener("mouseup",(function(){t.state.drawing&&(t.ctx.closePath(),t.setState({drawing:!1}),t.socket.emit("mouse_up",t.state.mouse))})),e.on("brush_size",(function(e){return t.ctx.lineWidth=e})),e.on("mouse_down",(function(e){t.ctx.beginPath(),t.ctx.moveTo(e.x+.5,e.y+.5),t.ctx.lineTo(e.x+.5,e.y+.5),t.ctx.stroke()})),e.on("mouse_move",(function(e){t.ctx.lineTo(e.x+.5,e.y+.5),t.ctx.stroke()})),e.on("mouse_up",(function(e){t.ctx.closePath(),t.ctx.moveTo(e.x+.5,e.y+.5)})),e.on("clear_canvas",this.clearCanvas),e.on("colour",this.changeColour.bind(this)),e.on("fill",(function(e){return t.floodFill(e.x,e.y)})),e.on("guessed",(function(e){t.addMessage(Object(s.jsxs)("div",{className:"message guessed",children:[e," guessed the word!"]}))})),e.on("close",(function(e){t.addMessage(Object(s.jsxs)("div",{className:"message close",children:['"',e,'" is 1 letter off!']}))})),e.on("contains",(function(e){t.addMessage(Object(s.jsxs)("div",{className:"message close",children:["You have found the following words: ",e.join(",")]}))})),e.on("chat_message",this.addUserMessage.bind(this)),e.on("round_start",(function(e,n){t.setState({drawer:e,time:n})})),e.on("round",(function(e){t.clearCanvas(),t.setState({hint:e})})),e.on("round_end",(function(e){t.setState({drawing:!1,drawer:void 0,word:void 0,hint:void 0}),t.addMessage(Object(s.jsxs)("div",{className:"message reveal",children:["The word was ",e,"."]}))})),e.on("choose",(function(e){t.setState({choices:e})})),e.on("drawer",(function(e){t.setState({word:e,choices:void 0})})),e.on("join",(function(e){t.setState({players:[].concat(Object(w.a)(t.state.players),[e])}),t.addMessage(Object(s.jsxs)("div",{className:"message reveal",children:[e.name," has joined the room."]})),console.log(t.state.players)})),e.on("players",(function(e){t.setState({players:e})})),e.on("leave",(function(e){var n=Object(w.a)(t.state.players),c=n.findIndex((function(t){return t.id===e})),a=n.splice(c,1)[0];t.addMessage(Object(s.jsxs)("div",{className:"message reveal",children:[a.name," has left the room."]})),t.setState({players:n})})),e.on("time",(function(e){return t.setState({time:e})}))}},{key:"addUserMessage",value:function(t,e){this.addMessage(Object(s.jsxs)("div",{className:"message",children:[Object(s.jsx)("strong",{children:t}),": ",e]}))}},{key:"addMessage",value:function(t){t=a.a.cloneElement(t,{key:this.state.chat.length}),this.setState({chat:[t].concat(Object(w.a)(this.state.chat))})}},{key:"changeColour",value:function(t){this.ctx.strokeStyle=this.ctx.fillStyle=t,this.brush.colour=t,this.brush.updateCursor(),this.forceUpdate(),this.socket.emit("colour",t)}},{key:"formatTime",value:function(t){var e=Math.floor(t/60),n=(t%60).toString().padStart(2,"0");return"".concat(e,":").concat(n)}},{key:"floodFill",value:function(t,e){var n=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:void 0}(this.brush.colour),s=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height),c=this.canvas.current.width,a=4*(e*c+t),i=s.data[a],o=s.data[a+1],r=s.data[a+2];if(i!==n.r||o!==n.g||r!==n.b){for(var l,u,d,h,j,m,b=[[t,e]];b.length;){for(u=(l=b.pop())[0],h=4*((d=l[1])*c+u);d>=0&&this.matchStartColor(s,h,i,o,r);)d-=1,h-=4*c;for(h+=4*c,d+=1,j=!1,m=!1;d<=this.canvas.current.height&&this.matchStartColor(s,h,i,o,r);)d+=1,this.colorPixel(s,h,n.r,n.g,n.b),u>0&&(this.matchStartColor(s,h-4,i,o,r)?j||(b.push([u-1,d]),j=!0):j&&(j=!1)),u<c&&(this.matchStartColor(s,h+4,i,o,r)?m||(b.push([u+1,d]),m=!0):m&&(m=!1)),h+=4*c}this.ctx.putImageData(s,0,0)}}},{key:"colorPixel",value:function(t,e,n,s,c,a){t.data[e]=n,t.data[e+1]=s,t.data[e+2]=c,t.data[e+3]=null!==a&&void 0!==a?a:255}},{key:"matchStartColor",value:function(t,e,n,s,c){var a=t.data[e],i=t.data[e+1],o=t.data[e+2];return a===n&&i===s&&o===c}}]),n}(c.Component));function M(t){var e,n,a=Object(c.useState)(!1),i=Object(O.a)(a,2),o=i[0],r=i[1],l=Object(c.useState)(!1),u=Object(O.a)(l,2),d=u[0],h=u[1],j=function(){var t=Object(c.useState)(0)[1];return function(){return t((function(t){return++t}))}}(),b=Object(c.useRef)(null),f=null!==(e=null===(n=b.current)||void 0===n?void 0:n.clientHeight)&&void 0!==e?e:0;return Object(s.jsxs)("div",{id:"to-draw",style:{height:(d?f:0)+100+"px"},onMouseEnter:function(){h(!0)},onMouseLeave:function(){o||h(!1)},children:[Object(s.jsx)("div",{id:"word",children:Object(s.jsx)("span",{children:t.word})}),Object(s.jsxs)("div",{id:"word-info",ref:b,children:[Object(s.jsx)("img",{alt:t.subtext,src:t.image,onLoad:function(){return j()}}),Object(s.jsx)("span",{id:"category",children:m(t.category)}),Object(s.jsx)("div",{id:"subtext",children:t.subtext}),Object(s.jsx)("button",{id:"pin",className:o?"on":"",onClick:function(){r(!o)},children:Object(s.jsx)("span",{className:"material-icons",children:"push_pin"})})]})]})}var F=function(){function t(e){Object(u.a)(this,t),this.game=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.tool="paint",this.colour="#010001",this.canvas.width=this.canvas.height=40}return Object(d.a)(t,[{key:"updateCursor",value:function(){switch(this.tool){case"paint":this.ctx.fillStyle=this.colour,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(20.5,20.5,10,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(20.5,20.5,9,0,2*Math.PI),this.ctx.stroke(),this.game.current.style.cursor="url(".concat(this.canvas.toDataURL(),") 20 20, default");break;case"fill":this.game.current.style.cursor='url("/images/fill.png") 20 20, default'}}}]),t}(),D=N;o.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(r.a,{children:Object(s.jsxs)(l.c,{children:[Object(s.jsx)(l.a,{path:"/",exact:!0,children:Object(s.jsx)(b,{})}),Object(s.jsx)(l.a,{path:"/create-room",children:Object(s.jsx)(k,{})}),Object(s.jsx)(l.a,{path:"/room/:room",component:D})]})})}),document.getElementById("root")),f()},70:function(t,e,n){},71:function(t,e,n){}},[[108,1,2]]]);
//# sourceMappingURL=main.e721ed4c.chunk.js.map